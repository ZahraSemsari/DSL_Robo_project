# DSL_Robo_project

```md
    # Robot DSL Compiler (ANTLR4 + Python)
    
    This project implements a small domain-specific language (DSL) for describing robot behavior using a Finite State Machine (FSM).  
    A DSL script is parsed with ANTLR4, converted into an Abstract Syntax Tree (AST), and then **Python code is generated** from that AST.
    
    **Pipeline:**  
    DSL file → ANTLR Parse Tree → AST → Python Code (`generated_robot.py`)
    
    ---
    
    ## Features
    
    - ANTLR4 grammar for a robot DSL
    - Parse Tree → AST construction using **ANTLR Listener**
    - Python code generation (executable output):
      - FSM with `enter_on`, `update_on`, `exit_on`
      - Transitions: `if (cond) goto State;`
      - Variable assignment
      - Actuator calls: `heater.on()` etc.
    
    ---
    
    ## Project Structure
    
    ```text
    robot-dsl/
      grammar/
        RobotDSL.g4
      src/
        generated/                # auto-generated by ANTLR (Lexer/Parser/Listener)
        ast.py                    # AST node definitions
        ast_builder_listener.py   # builds AST using ANTLR Listener
        codegen_python.py         # generates Python from AST
        main.py                   # CLI: dump AST, generate Python
      examples/
        TempBot.dsl               # sample DSL program
      generated_robot.py          # output (created by codegen)
```

---

## Requirements

* Python 3.10+ (recommended)
* Java (required for running the ANTLR tool)
* ANTLR4 tool + Python runtime

Install Python runtime:

```bash
pip install antlr4-python3-runtime
```

---

## Generate Lexer/Parser/Listener (ANTLR)

Run from the project root:

```bash
antlr4 -Dlanguage=Python3 -listener -o src/generated grammar/RobotDSL.g4
```

If the `antlr4` command is not available, run the jar directly:

```bash
java -jar antlr-4.x-complete.jar -Dlanguage=Python3 -listener -o src/generated grammar/RobotDSL.g4
```

Make sure these files exist (empty files are OK):

```text
src/__init__.py
src/generated/__init__.py
```

---

## Example DSL Program

`examples/TempBot.dsl`

```dsl
robot TempBot {
  sensors {
    sensor temperature: float;
  }

  actuators {
    actuator heater: Heater;
  }

  vars {
    var target: float = 30.0;
  }

  behavior TempControl {
    initial Idle;

    state Idle {
      update_on {
        if (temperature < target) goto Heating;
      }
    }

    state Heating {
      enter_on {
        heater.on();
      }

      update_on {
        if (temperature >= target) goto Idle;
      }

      exit_on {
        heater.off();
      }
    }
  }
}
```

---

## CLI Usage

Run commands from the project root.

### 1) Print AST as JSON

```bash
python -m src.main examples/TempBot.dsl ast
```

### 2) Generate Python Code

```bash
python -m src.main examples/TempBot.dsl genpy --out generated_robot.py
```

### 3) Run the Generated Python

```bash
python generated_robot.py
```

---

## Important Note About Sensors

Sensors are runtime inputs. The generated code reads sensor values from `ctx.sensors`.
If a sensor value is missing, expressions like `temperature < target` may fail because `temperature` becomes `None`.

To test quickly, edit `generated_robot.py` inside `run_demo()`:

```python
ctx.sensors["temperature"] = 25.0
```

Or update it every tick:

```python
for i in range(steps):
    ctx.sensors["temperature"] = 25.0 + i
    fsm.tick()
```

---

## Notes / Design Choices

* **Sensors** are read-only runtime inputs (`ctx.sensors`)
* **Variables** are stored in `ctx.vars`
* **Actuators** are stored in `ctx.actuators`
* The generated code uses a `Ctx` object to avoid global state and make testing easier

---

## Troubleshooting

### Parser error: `mismatched input '<EOF>' expecting 'robot'`

This usually means the DSL file is empty or is not being read correctly.

PowerShell check:

```powershell
Get-Content .\examples\TempBot.dsl
```

### `ModuleNotFoundError: src.generated...`

* Ensure ANTLR code generation created `src/generated/*`
* Ensure `src/__init__.py` and `src/generated/__init__.py` exist
* Run commands from the project root (not inside `src/`)



